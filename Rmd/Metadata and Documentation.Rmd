---
title: " Data Documentation & Metadata"
author: "ACCE Data Management Course"
date: "17 February 2017"
output: 
    ioslides_presentation:
      css: css/ioslides_default.css
---

## Documenting your data {.columns-2}

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> I see tons of spreadsheets that i don&#39;t understand anything (or the stduent), making it really hard to share.</p>&mdash; Erika Berenguer (@Erika_Berenguer) <a href="https://twitter.com/Erika_Berenguer/status/556111838715580417">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> Create a tab on your excel sheet that explains exactly what you did to get each part of the data and how you have treat it so far.</p>&mdash; Erika Berenguer (@Erika_Berenguer) <a href="https://twitter.com/Erika_Berenguer/status/556109844659597312">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<br>
<br>

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> <a href="https://twitter.com/SuseJohnston">@SuseJohnston</a> Write comments into any data or code file as if for yourself one year from now when you won&#39;t recall the details.</p>&mdash; Albert Cardona (@albertcardona) <a href="https://twitter.com/albertcardona/status/556113639594528769">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


## Documenting your data {.columns-2}

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/srsupp">@srsupp</a> <a href="https://twitter.com/tomjwebb">@tomjwebb</a> Document! Many sharing platforms exist (e.g. <a href="https://twitter.com/figshare">@figshare</a>), but w/o documentation/metadata, research data aren&#39;t v. useful</p>&mdash; Jonathan Petters (@jon_petters) <a href="https://twitter.com/jon_petters/status/556146541921320961">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> <a href="https://twitter.com/ScientificData">@ScientificData</a> &quot;Document. Everything.&quot; Data without documentation has no value.</p>&mdash; Sven Kochmann (@indianalytics) <a href="https://twitter.com/indianalytics/status/556120920881115136">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<br>
<br>

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="it" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> Annotate, annotate, annotate!</p>&mdash; CanJFishAquaticSci (@cjfas) <a href="https://twitter.com/cjfas/status/556109252788379649">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

## Documenting your data {.columns-2}

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/tomjwebb">@tomjwebb</a> Have good metadata so others can understand it/use it</p>&mdash; Nathan B Furey (@NBFurey) <a href="https://twitter.com/NBFurey/status/556113773811867648">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/Sal_Keith">@Sal_Keith</a> +1 Metadata essential &amp; prerequisite for the new breed of data journals like <a href="https://twitter.com/ScientificData">@ScientificData</a> or repos like <a href="https://twitter.com/datadryad">@datadryad</a> <a href="https://twitter.com/tomjwebb">@tomjwebb</a></p>&mdash; Gavin Simpson (@ucfagls) <a href="https://twitter.com/ucfagls/status/556111062517284864">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<br>
<br>

<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="und" dir="ltr">Document all the metadata (including protocols).<a href="https://twitter.com/tomjwebb">@tomjwebb</a></p>&mdash; Ward Appeltans (@WrdAppltns) <a href="https://twitter.com/WrdAppltns/status/556108414955560961">January 16, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

## #otherpeoplesdata dream match!

> imagine an open data set

It's out there somewhere,

#### How would you locate it?

<br>

- what details would you need to know to determine relevance? 
- what information would you need to know to use it?
<br>

> #### Think about all you would neeed to understand someone else's data. In 18 months **YOU  will be that other person with your own data.**

## Metadata 

> ### Information that **describes, explains, locates**, or in some way makes it easier to **find, access**, and **use** a resource (in this case, data). 


## Data about data

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide05.jpg" height="500">

## Metadata & Data Documentation 

<br>

### **Different types data require different metadata**

- At the very least: **create a metadata tab within your raw data spreadsheet**
- Ideally have a system of **normalised tables** [see section 3 in this post](https://dynamicecology.wordpress.com/2016/08/22/ten-commandments-for-good-data-management/) and **`README`s** to manage and document metadata.

<br>      
	

<p class="accentborder"><b>**Ensure everything someone might need to understand your data is documented**</p></b>
      
 

## planning for data reuse 

**You need to have a plan on how to record metadata**

### Data Reuse Checklist

[http://mozillascience.github.io/checklist/](http://mozillascience.github.io/checklist/
)

<br>
<br>

<img src="~/Documents/WORK/ACCE Data management course/Resources/figures/msl logo.png" height="100">


## Let's make a start with your data: {.columns-2}


#### get organised

- Add your data to the `data/` folder.
- create a new script eg `process_filename.R`
- load your data
- have a look at it with `Viewer(data)`


#### what format is in?
- is it tidy?
- is it normalised?
- not sure? ask for help

## tidy and normalise {.columns-2}

- denormalised

<img src="https://dynamicecology.files.wordpress.com/2016/08/denormalized.jpg" height="100">

- almost fully normalised 

<img src="https://dynamicecology.files.wordpress.com/2016/08/normalized.jpg" height="100">

- intermediate 

<img src="https://dynamicecology.files.wordpress.com/2016/08/partnormalized.jpg?w=584&h=184" height="100">

# Example Data & Metadata

## Bird Trait Networks project 

<br> 

***Compile large dataset on bird reproductive, morphological, physiological, life history and ecological traits across as many bird species as possible***

<br>

- **Primarily a data management project:**
        + `dataset & code the outputs`
  
 
  - **1,307,253** data points
  - **202** variables


## Data & Metadata csv 

Here's the full dataset on bird traits I compiled. This is the **long format**

**TRAIT** is the observational unit

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/datal.png" height="350">



## Data & Metadata csv 

Here's the analytical dataset. This is the **wide format** and conducive to analysis

**SPECIES** is the observational unit

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/dataw.png" height="350">


## Data & Metadata csv 

And here's the metadata table I created for each variable

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/meta.png" height="350">

# Working with Metadata in R


 
## Metadata in R 

When using data in `R`, short (but informative) abbreviations of variable names are preferable for ease of use in coding. 

However, poor recording of what abbreviations stand for can cause much confusion down the line and during collaboration.

<br>

**Good practice:**

<big> ***Include columns with more detailed description and units in your metadata*** </big>

These can be very useful when plotting, when the full variable descriptions, including units, are required

## Metadata in R 

Knowledge of data type can also be useful

eg. is the data:

- continuous
- integer
- categorical
- binary

## Metadata in R 

Let's use an subset of the Bird Trait Networks data to explore some of the concepts and tools we've been discussing:

```{r, message=FALSE, echo=F}

### SETTINGS ##############################################################
input.folder <- "~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/"

### FILES #################################################################

metadata <- read.csv(paste(input.folder,"metadata.csv", sep =""), stringsAsFactors = F)
dd   <- read.csv(paste(input.folder,"data.csv", sep =""))

### PACKAGES #################################################################

require(knitr)
require(xtable)
```



```{r}

metadata <- read.csv(paste(input.folder,"metadata.csv", sep =""), stringsAsFactors = F)
dd   <- read.csv(paste(input.folder,"data.csv", sep =""))
```


## Metadata in R 

here's the data:
```{r}
head(dd)

```

## Metadata in R 


here's the metadata:

```{r}
head(metadata)

```


## Uses of metadata in analysis 

Longer descriptions of variables, units and other useful metadata can be stored as part of dataframes in R using the function ```attributes()```

## Uses of metadata in analysis 

All r object have attributes and basic `data.frames` have 3. These can be accessed by using the same function.

```{r}
str(attributes(dd))

```

## Appending metadata as attributes 

So lets append some metadata to the **`dd`** data.frame as attributes. Indexing using the match function ensures the attributes are stores in order that match match the variable names

```{r}
descr.att <- metadata$descr[match(names(dd), metadata$code)]
names(descr.att) <- names(dd)
attributes(dd)$descr <- descr.att
  
units.att <- metadata$units[match(names(dd), metadata$code)]
names(units.att) <- names(dd)
attributes(dd)$units <- units.att
```

```{r}
str(attributes(dd))
```


## Accessing attributes 

So let's go ahead and make use of some of those attributes. There's a few ways they can be accessed. Say we want the `descr` attribute for all variables
```{r}
attr(dd, "descr")
```

## Accessing attributes 

So let's go ahead and make use of some of those attributes. There's a few ways they can be accessed. Say we want the `descr` attribute for all variables

```{r}
attributes(dd)$descr
```

## Working with attributes 

Let's make an axis label by combining the description and unit attributes using the `paste` function.

```{r}
descr <- attributes(dd)$descr["song.dur"]
descr

unit <- attributes(dd)$unit["song.dur"]
unit

paste(descr, " (", unit, ")", sep = "")
```

## Pros and cons of attributes 

### ***PROs***

  - Attached to dataset
  - Flexible
  
### ***CONs***

  - Not attached to individual columns
  - Need to be updated if data.frame appended
  
### Other options 
  - [**`label`**](http://www.inside-r.org/packages/cran/hmisc/docs/as.data.frame.labelled) function in pckg {Hmisc}
  - directly using the your **metadata data.frame** for reference
  
# Putting it all together in R Markdown


[Exercise](http://rpubs.com/annakrystalli/170777)
