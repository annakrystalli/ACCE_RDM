---
title: " Data Documentation & Metadata"
author: "ACCE Data Management Course"
date: "14 April 2016"
output: ioslides_presentation
---

## Documenting your data {.smaller}


<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide02.jpg" height="500">

## Documenting your data {.smaller}


<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide03.jpg" height="500">

## Documenting your data {.smaller}


<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide04.jpg" height="500">


## #OtherPeoplesData

<iframe width="560" height="315" src="https://www.youtube.com/embed/N2zK3sAtr-4" frameborder="0" allowfullscreen></iframe>

## Metadata {.smaller}

> ### Information that **describes, explains, locates**, or in some way makes it easier to **find, access**, and **use** a resource (in this case, data). 

> Data about data

## Metadata {.smaller}

Important for:

  - **You!** (especially when you come back to datasets after some time)
  - **Collaborators** (trying to make sense of your data)
  - **Open Science** (so that your data can contribute to wider scientific investigations)
  
<br> 

Think about what you would need to know to understand someone else's data. In 18 months **you WILL be that other person.**


**You need to have a plan and a record!**


## Metadata {.smaller}

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide05.jpg" height="500">

## Planning {.smaller}

### Planning for Data Reuse Checklist

[http://mozillascience.github.io/checklist/](http://mozillascience.github.io/checklist/
)

<br>
<br>

<img src="~/Documents/WORK/ACCE Data management course/Resources/figures/msl logo.png" height="100">

## Planning for Data Reuse Checklist

<iframe src="http://mozillascience.github.io/checklist/" style="border: none; width: 440px; height: 900px"></iframe>

## Raw data are sacrosanct {.smaller}

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/figures/Slide07.jpg" height="500">

## Preserve raw data 

- **Raw data is sacred**
- Clearly document any processing in the metadata

       + Well-commented script-based manipulation (e.g. in R) makes this easy
       
- Do **back up**, wonâ€™t you?


## Metadata & Data Documentation {.smaller}

- At the very least: **create a metadata tab within your raw data spreadsheet**
- Different forms of your data may require different metadata

      + **Ensure everything someone might need to understand your data is documented**
      
<br>      
		   


# Example Data & Metadata

## Bird Trait Networks project {.smaller}

<br> 

***Compile large dataset on bird reproductive, morphological, physiological, life history and ecological traits across as many bird species as possible***

<br>

- **Primarily a data management project:**
        + `dataset & code the outputs`
  
 
  - **1,307,253** data points
  - **202** variables


## Data & Metadata csv {.smaller}

Here's the full dataset on bird traits I compiled. This is the **long format**

**TRAIT** is the observational unit

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/datal.png" height="350">



## Data & Metadata csv {.smaller}

Here's the analytical dataset. This is the **wide format** and conducive to analysis

**SPECIES** is the observational unit

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/dataw.png" height="350">


## Data & Metadata csv {.smaller}

And here's the metadata table I created for each variable

<img src="~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/meta.png" height="350">

# Working with Metadata in R


 
## Metadata in R {.smaller}

When using data in `R`, short (but informative) abbreviations of variable names are preferable for ease of use in coding. 

However, poor recording of what abbreviations stand for can cause much confusion down the line and during collaboration.

<br>

**Good practice:**

<big> ***Include columns with more detailed description and units in your metadata*** </big>

These can be very useful when plotting, when the full variable descriptions, including units, are required

## Metadata in R {.smaller}

Knowledge of data type can also be useful

eg. is the data:

- continuous
- integer
- categorical
- binary

## Metadata in R {.smaller}

Let's use an subset of the Bird Trait Networks data to explore some of the concepts and tools we've been discussing:

```{r, message=FALSE, echo=F}

### SETTINGS ##############################################################
input.folder <- "~/Documents/WORK/ACCE Data management course/workflow/inputs/exercises/metadata/"

### FILES #################################################################

metadata <- read.csv(paste(input.folder,"metadata.csv", sep =""), stringsAsFactors = F)
dd   <- read.csv(paste(input.folder,"data.csv", sep =""))

### PACKAGES #################################################################

require(knitr)
require(xtable)
```



```{r}

metadata <- read.csv(paste(input.folder,"metadata.csv", sep =""), stringsAsFactors = F)
dd   <- read.csv(paste(input.folder,"data.csv", sep =""))
```


## Metadata in R {.smaller}

here's the data:
```{r}
head(dd)

```

## Metadata in R {.smaller}


here's the metadata:

```{r}
head(metadata)

```


## Uses of metadata in analysis 

Longer descriptions of variables, units and other useful metadata can be stored as part of dataframes in R using the function ```attributes()```

## Uses of metadata in analysis {.smaller}

All r object have attributes and basic `data.frames` have 3. These can be accessed by using the same function.

```{r}
str(attributes(dd))

```

## Appending metadata as attributes {.smaller}

So lets append some metadata to the **`dd`** data.frame as attributes. Indexing using the match function ensures the attributes are stores in order that match match the variable names

```{r}
descr.att <- metadata$descr[match(names(dd), metadata$code)]
names(descr.att) <- names(dd)
attributes(dd)$descr <- descr.att
  
units.att <- metadata$units[match(names(dd), metadata$code)]
names(units.att) <- names(dd)
attributes(dd)$units <- units.att
```

```{r}
str(attributes(dd))
```


## Accessing attributes {.smaller}

So let's go ahead and make use of some of those attributes. There's a few ways they can be accessed. Say we want the `descr` attribute for all variables
```{r}
attr(dd, "descr")
```

## Accessing attributes {.smaller}

So let's go ahead and make use of some of those attributes. There's a few ways they can be accessed. Say we want the `descr` attribute for all variables

```{r}
attributes(dd)$descr
```

## Working with attributes {.smaller}

Let's make an axis label by combining the description and unit attributes using the `paste` function.

```{r}
descr <- attributes(dd)$descr["song.dur"]
descr

unit <- attributes(dd)$unit["song.dur"]
unit

paste(descr, " (", unit, ")", sep = "")
```

## Pros and cons of attributes {.smaller}

### ***PROs***

  - Attached to dataset
  - Flexible
  
### ***CONs***

  - Not attached to individual columns
  - Need to be updated if data.frame appended
  
### Other options 
  - [**`label`**](http://www.inside-r.org/packages/cran/hmisc/docs/as.data.frame.labelled) function in pckg {Hmisc}
  - directly using the your **metadata data.frame** for reference
  
# Putting it all together in R Markdown


[Exercise](http://rpubs.com/annakrystalli/170777)
